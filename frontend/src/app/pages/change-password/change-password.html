<div
  class="form-card flex flex-col justify-center items-center w-full max-w-md rounded-2xl font-[Roboto] bg-[var(--base-form-bg)] p-8 shadow-xl mx-auto mt-10"
>
  <div class="text-center mb-6">
    <div class="flex justify-center mb-4">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-16 h-16 text-[var(--base-btn-secondary-bg)]"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"
        />
      </svg>
    </div>
    <h1 class="text-2xl font-bold text-[var(--base-gray-darker)] tracking-wide">
      Zmiana hasła wymagana
    </h1>
    <p class="text-base font-normal text-[var(--base-form-lighter-text)] tracking-wide mt-2">
      Ze względów bezpieczeństwa musisz zmienić swoje tymczasowe hasło przed kontynuowaniem.
    </p>
  </div>

  <form class="w-full" [formGroup]="passwordForm" (ngSubmit)="onSaveClick()" novalidate>
    <div class="mb-5">
      <label
        for="current-password"
        class="block text-sm font-medium text-[var(--base-gray-darker)] mb-1"
      >
        Aktualne hasło (tymczasowe)
      </label>
      <input
        type="password"
        id="current-password"
        name="current-password"
        formControlName="currentPassword"
        placeholder="Wpisz hasło z emaila"
        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition duration-150"
        [class.border-red-500]="
          passwordForm.get('currentPassword')?.invalid &&
          passwordForm.get('currentPassword')?.touched
        "
        [class.border-gray-300]="
          !(
            passwordForm.get('currentPassword')?.invalid &&
            passwordForm.get('currentPassword')?.touched
          )
        "
      />
      @if (
        passwordForm.get('currentPassword')?.hasError('required') &&
        passwordForm.get('currentPassword')?.touched
      ) {
        <p class="text-red-600 text-sm mt-1">Aktualne hasło jest wymagane.</p>
      }
    </div>

    <div class="mb-5">
      <label
        for="new-password"
        class="block text-sm font-medium text-[var(--base-gray-darker)] mb-1"
      >
        Nowe hasło
      </label>
      <input
        type="password"
        id="new-password"
        name="new-password"
        formControlName="newPassword"
        placeholder="Minimum 8 znaków"
        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition duration-150"
        [class.border-red-500]="
          passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched
        "
        [class.border-gray-300]="
          !(passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched)
        "
      />
      @if (
        passwordForm.get('newPassword')?.hasError('required') &&
        passwordForm.get('newPassword')?.touched
      ) {
        <p class="text-red-600 text-sm mt-1">Nowe hasło jest wymagane.</p>
      }
      @if (
        passwordForm.get('newPassword')?.hasError('minlength') &&
        passwordForm.get('newPassword')?.touched
      ) {
        <p class="text-red-600 text-sm mt-1">Hasło musi mieć co najmniej 8 znaków.</p>
      }
    </div>

    <div class="mb-5">
      <label
        for="confirm-password"
        class="block text-sm font-medium text-[var(--base-gray-darker)] mb-1"
      >
        Powtórz nowe hasło
      </label>
      <input
        type="password"
        id="confirm-password"
        name="confirm-password"
        formControlName="confirmPassword"
        placeholder="Powtórz nowe hasło"
        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition duration-150"
        [class.border-red-500]="
          (passwordForm.get('confirmPassword')?.invalid &&
            passwordForm.get('confirmPassword')?.touched) ||
          (passwordForm.errors?.['mismatch'] && submitted)
        "
        [class.border-gray-300]="
          !(
            (passwordForm.get('confirmPassword')?.invalid &&
              passwordForm.get('confirmPassword')?.touched) ||
            (passwordForm.errors?.['mismatch'] && submitted)
          )
        "
      />
      @if (
        passwordForm.get('confirmPassword')?.hasError('required') &&
        passwordForm.get('confirmPassword')?.touched
      ) {
        <p class="text-red-600 text-sm mt-1">Potwierdzenie hasła jest wymagane.</p>
      }
      @if (passwordForm.errors?.['mismatch'] && submitted) {
        <p class="text-red-600 text-sm mt-1">Hasła muszą się zgadzać.</p>
      }
    </div>

    @if (saveSuccess()) {
      <div
        class="mb-4 p-3 bg-green-50 border border-green-200 text-green-700 rounded-lg"
        role="alert"
      >
        <p class="font-bold">Sukces!</p>
        <p class="text-sm">Hasło zostało zmienione. Przekierowuję do profilu...</p>
      </div>
    }

    @if (saveError()) {
      <div class="mb-4 p-3 bg-red-50 border border-red-200 text-red-600 rounded-lg" role="alert">
        <p class="font-bold">Błąd:</p>
        <p class="text-sm">{{ saveError() }}</p>
      </div>
    }

    <button
      type="submit"
      [disabled]="passwordForm.invalid || loading"
      class="w-full bg-[var(--base-btn-secondary-bg)] mt-4 p-3 rounded-lg text-white font-bold text-base tracking-wide transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 hover:bg-[var(--base-btn-secondary-bg-hover)]"
    >
      @if (loading) {
        <svg
          class="animate-spin h-5 w-5 text-white"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          ></path>
        </svg>
        <span>Zmieniam hasło...</span>
      } @else {
        <span>Zmień hasło</span>
      }
    </button>
  </form>
</div>
