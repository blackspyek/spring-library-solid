
@if (showMobileA11yMenu) {
  <div
    class="fixed inset-0 bg-black/50 z-20 md:hidden"
    (click)="toggleMobileA11yMenu()"
  ></div>
}

<footer
  class="md:hidden bg-[var(--base-blue-dark)] h-16 flex items-center justify-around fixed bottom-0 left-0 right-0 z-30"
>
  <div
    class="mobile-a11y-panel absolute bottom-full left-0 right-0 bg-[color:var(--base-blue-dark)] text-[color:var(--base-input-bg)] p-4 rounded-t-2xl shadow-[0_-4px_20px_rgba(0,0,0,0.3)] transition-transform duration-300 transform origin-bottom"
    [class.translate-y-0]="showMobileA11yMenu"
    [class.translate-y-[120%]]]="!showMobileA11yMenu"
    [class.invisible]="!showMobileA11yMenu"
  >
    <div class="flex flex-col gap-4">
      <h3 class="text-center text-sm uppercase tracking-widest font-bold text-[color:var(--base-input-bg)] mb-2">Ułatwienia dostępu</h3>

      <div class="flex items-center justify-between bg-[color:var(--base-white-transparent)] p-3 rounded-lg">
        <span class="flex items-center gap-2">
          <mat-icon fontIcon="contrast"></mat-icon>
          Wysoki kontrast
        </span>
        <button
          class="contrast-toggle w-12 h-6 rounded-full relative transition-colors duration-200"
          [class.bg-green-500]="highContrast"
          [style.background-color]="!highContrast ? 'var(--gray-400-to-black)' : null"
          (click)="toggleHighContrast()"
        >
          <span
            class="absolute top-1 left-1 bg-[color:var(--base-input-bg)] w-4 h-4 rounded-full transition-transform duration-200"
            [class.translate-x-6]="highContrast"
          ></span>
        </button>
      </div>

      <div class="flex items-center justify-between bg-[color:var(--base-white-transparent)]  p-3 rounded-lg">
        <span class="flex items-center gap-2">
          <mat-icon fontIcon="format_size"></mat-icon>
          Rozmiar tekstu
        </span>
        <div class="flex gap-2">
          <button (click)="decreaseRootFontSize()" class="w-8 h-8 flex items-center justify-center bg-[color:var(--base-white-transparent)]  rounded active:bg-white/30">A-</button>
          <button (click)="increaseRootFontSize()" class="w-8 h-8 flex items-center justify-center bg-[color:var(--base-white-transparent)]  rounded active:bg-white/30">A+</button>
        </div>
      </div>

      <button
        (click)="openFeedbackDialog()"
        class="flex items-center justify-center gap-2 w-full bg-[color:var(--base-white-transparent)] hover:bg-[color:var(--base-white-transparent)] p-3 rounded-lg text-[color:var(--base-input-bg)] transition-colors mt-1"
      >
        <mat-icon fontIcon="error_outline"></mat-icon>
        Zgłoś uwagę / błąd
      </button>
    </div>
  </div>
  <div class="absolute inset-x-0 -top-8 flex flex-col items-center justify-center z-40 pointer-events-none">
    <button
      (click)="openQrDialog()"
      class="w-[65px] h-[65px] bg-[color:var(--base-blue-dark-to-black)] text-[color:var(--search-bar-catalog)] rounded-full flex items-center justify-center cursor-pointer shadow-lg pointer-events-auto transition-transform active:scale-95"
    >
      <mat-icon class="scale-[1.875]" fontIcon="qr_code" aria-hidden="true"></mat-icon>
    </button>
    <span class="mt-1 text-xs text-[color:var(--base-input-bg)] font-normal pointer-events-none drop-shadow-md ">
      Moja karta
    </span>
  </div>


  @for (item of mobileNavItems(); track item.label) {
    @if (item.label === '') {
      <div class="w-10"></div> }
    @else if (item.action) {
      <button
        type="button"
        (click)="item.action()"
        class="flex flex-col items-center text-xs text-[color:var(--base-input-bg)] p-2 transition duration-150 cursor-pointer min-w-[64px]"
        [class.active-mobile-link]="showMobileA11yMenu"
      >
        <mat-icon fontIcon="{{ item.icon }}" aria-hidden="true"></mat-icon>
        <span class="mt-1">{{ item.label }}</span>
      </button>
    }
    @else {
      <a
        [routerLink]="[item.link]"
        class="flex flex-col items-center text-xs text-[color:var(--base-input-bg)] p-2 transition duration-150 cursor-pointer min-w-[64px]"
        routerLinkActive="active-mobile-link"
        [routerLinkActiveOptions]="{ exact: item.link === '/' }"
      >
        <mat-icon fontIcon="{{ item.icon }}" aria-hidden="true"></mat-icon>
        <span class="mt-1">{{ item.label }}</span>
      </a>
    }
  }
</footer>

<header
  class="hidden md:flex bg-[var(--base-blue-dark)] text-[var(--nav-base-color)] h-16 shadow-lg px-8 items-center justify-between font-[Inter]"
>
  <div class="flex items-center gap-8 justify-center">
    <a [routerLink]="['/']" class="flex items-center gap-4 cursor-pointer">
      <img
        [ngSrc]="highContrast ? '/logo_high.svg' : '/logo.svg'"
        width="48"
        height="48"
        alt="Logo w kształcie książki"
        priority
        class="object-cover"
      />
      <span class="text-[var(--nav-base-color)] text-base font-bold tracking-widest font-[Inter]">
        BIBLIOTEKA
      </span>
    </a>

    <nav class="flex h-full gap-4">
      @for (item of desktopNavItems; track item.label) {
        <a
          [routerLink]="[item.link]"
          class="flex flex-col justify-center cursor-pointer hover:text-[color:var(--base-input-bg)] transition duration-150 text-base font-light font-[Inter] tracking-wide"
          routerLinkActive="active-link"
          [routerLinkActiveOptions]="{ exact: item.link === '/' }"
        >
          {{ item.label }}
        </a>
      }
      @if (isLibrarian()) {
        <a
          [routerLink]="['/zarzadzanie-wypozyczeniami']"
          class="flex items-center hover:text-[color:var(--base-input-bg)] transition duration-150 text-base font-light font-[Inter] tracking-wide gap-1"
          routerLinkActive="active-link"
        >
          <span>Zarządzanie</span>
        </a>
      }
    </nav>
  </div>

  <div class="flex items-center gap-6">

    <div class="flex items-center gap-4 text-sm font-medium">
      <button
        type="button"
        class="flex items-center cursor-pointer hover:text-[color:var(--gray-300-to-darkyellow)] transition-colors bg-transparent border-none text-inherit"
        (click)="openFeedbackDialog()"
        aria-haspopup="dialog"
        aria-label="Zgłoś uwagę dotyczącą dostępności lub funkcjonalności"
      >
        <span class="material-icons text-xl mr-1"> error_outline </span>
        <span class="hidden lg:inline">Zgłoś uwagę</span>
      </button>

      <div class="flex items-center gap-3 border-l border-white/20 pl-4">
        <button
          type="button"
          class="contrast-toggle flex items-center cursor-pointer hover:text-[color:var(--gray-300-to-darkyellow)] transition-colors"
          (click)="toggleHighContrast()"
          [attr.aria-pressed]="highContrast"
          aria-label="Przełącz wysoki kontrast"
        >
          <span class="material-icons text-xl mr-1"> contrast </span>
        </button>

        <button
          type="button"
          (click)="decreaseRootFontSize()"
          aria-label="Zmniejsz czcionkę"
          class="hover:text-[color:var(--gray-300-to-darkyellow)] transition-colors font-bold px-1"
        >
          A-
        </button>

        <button
          type="button"
          (click)="increaseRootFontSize()"
          aria-label="Zwiększ czcionkę"
          class="hover:text-[color:var(--gray-300-to-darkyellow)] transition-colors font-bold px-1"
        >
          A+
        </button>
      </div>
    </div>

@if (isLoggedIn()) {
      <div class="group flex items-center gap-0 rounded-full p-1 transition-all duration-300 border border-transparent hover:border-white/10 hover:bg-white/5">
        <a
          [routerLink]="['/profil']"
          class="flex items-center gap-1 px-2 py-1 cursor-pointer transition-all duration-150"
        >
          <mat-icon
            class="material-icons-outlined scale-[0.85]"
            fontIcon="person"
            aria-hidden="true"
          ></mat-icon>
          <span
            routerLinkActive="active-link-account"
            class="text-base font-light font-[Inter] tracking-wide"
          >
            Moje konto
          </span>
        </a>

        <div
          class="flex items-center overflow-hidden max-w-0 opacity-0 group-hover:max-w-[120px] group-hover:opacity-100 transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)]"
        >
          <div class="h-5 w-[1px] bg-white/30 mx-1"></div>
          <button
            (click)="logout()"
            class="logout-btn flex items-center gap-1 px-2 py-1 text-sm text-[var(--nav-base-color)]/70 whitespace-nowrap hover:text-[var(--nav-base-color)] rounded-full transition-colors cursor-pointer"
          >
            <span>Wyloguj</span>
            <mat-icon
              class="scale-[0.7] transition-transform duration-300"
              fontIcon="logout"
              aria-hidden="true"
            ></mat-icon>
          </button>
        </div>
      </div>
    } @else {
      <a
        [routerLink]="['/zaloguj-sie']"
        class="flex items-center hover:text-[color:var(--gray-300-to-darkyellow)] transition duration-150 text-base font-light font-[Inter] tracking-wide gap-1 cursor-pointer ml-2"
      >
        <mat-icon
          class="material-icons-outlined scale-[0.85]"
          fontIcon="person"
          aria-hidden="true"
        ></mat-icon>
        <span>Zaloguj</span>
      </a>
    }
  </div>
</header>
